<div class="dashboard">
    <!-- Header -->
    <!-- <div class="dashboard-header">
        <div class="header-left">
            <img src="/images/site/byui_class_scheduler_logo.png" alt="BYU-I Class Scheduler Logo" class="logo">
            <h1>Class Scheduler</h1>
        </div>
        <div class="user-info">
            <span class="user-email"><%#= user.email %></span>
            <a href="/logout" class="logout-btn">Logout</a>
        </div>
    </div> -->

    <!-- Main Content -->
    <div class="dashboard-content">
        <!-- Google Calendar Status Section -->
        <div id="calendarStatusSection" class="calendar-status-section" style="display: none;">
            <div id="calendarStatusBox" class="calendar-status-box"></div>
        </div>

        <!-- Create Event Form -->
        <div class="create-section">
            <h2>Create New Schedule</h2>
            
            <form id="scheduleForm">
                <!-- Semester Selection -->
                <div class="form-group">
                    <label for="semester">Semester</label>
                    <select id="semester" name="semester" required>
                        <option value="">Select Semester</option>
                        <option value="Fall">Fall</option>
                        <option value="Winter">Winter</option>
                        <option value="Spring">Spring</option>
                    </select>
                </div>

                <!-- Calendar Selection -->
                <div class="form-group">
                    <label>Calendar for this semester</label>
                    <div class="calendar-selection-group">
                        <select id="calendarSelection" name="calendarSelection" required>
                            <option value="">-- Select Calendar --</option>
                            <option value="primary">Use default calendar</option>
                            <option value="create">Create a new calendar for this semester</option>
                        </select>
                        <div id="existingCalendars" class="existing-calendars-list"></div>
                    </div>
                </div>

                <!-- Number of Classes -->
                <div class="form-group">
                    <label for="numClasses">Number of Classes</label>
                    <input type="number" id="numClasses" name="numClasses" min="1" max="10" value="1" required>
                </div>

                <!-- Date Range Info Message -->
                <div class="info-message">
                    <p>ðŸ“… <strong>Fine-tune your dates:</strong> Adjust the start and end dates to match your semester. Classes will only occur on the selected days between these dates.</p>
                </div>

                <!-- Date Range -->
                <div class="date-range">
                    <div class="form-group">
                        <label for="beginDate">Start Date</label>
                        <input type="date" id="beginDate" name="beginDate" required>
                    </div>
                    <div class="form-group">
                        <label for="endDate">End Date</label>
                        <input type="date" id="endDate" name="endDate" required>
                    </div>
                </div>

                <!-- Classes Container -->
                <div class="classes-container" id="classesContainer">
                    <!-- Classes will be dynamically added here -->
                </div>

                <!-- Submit Button -->
                <button type="submit" class="submit-btn">Generate Schedule</button>
            </form>
        </div>

        <!-- Events List Section -->
        <div class="events-section">
            <div class="events-header">
                <h2>Your Scheduled Events</h2>
                <!-- Sync Status Legend -->
                <div class="sync-status-legend">
                    <div class="legend-title">Google Calendar Sync Status:</div>
                    <div class="legend-items">
                        <div class="legend-item">
                            <span class="legend-symbol synced">âœ“</span>
                            <span class="legend-text">Synced</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-symbol missing">âœ—</span>
                            <span class="legend-text">Missing</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-symbol not-synced">âŠ˜</span>
                            <span class="legend-text">Not Synced</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-symbol no-auth">âš </span>
                            <span class="legend-text">No Auth</span>
                        </div>
                    </div>
                </div>
            </div>
            <div id="eventListContainer">
                <div class="loading">Loading your events...</div>
            </div>
        </div>
    </div>

    <!-- Edit Event Modal -->
    <div id="editModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Class</h2>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            <form id="editForm" onsubmit="submitEditForm(event)">
                <div class="form-group">
                    <label for="editClassName">Class Name</label>
                    <input type="text" id="editClassName" required>
                </div>

                <div class="form-group">
                    <label for="editLocation">Location</label>
                    <input type="text" id="editLocation" placeholder="e.g., KIM 101" required>
                </div>

                <div class="form-group">
                    <label>Time Slot</label>
                    <div class="time-slot-input-group">
                        <div class="time-form-preset" id="editTimePreset">
                            <select id="editTimeSlot">
                                <option value="">Select Time Slot</option>
                            </select>
                            <button type="button" class="toggle-time-btn" onclick="toggleEditTimeMode()">Or Enter Custom Time</button>
                        </div>
                        <div class="time-form-custom" id="editTimeCustom" style="display: none;">
                            <div class="custom-time-input">
                                <input type="time" id="editCustomStartTime">
                                <input type="time" id="editCustomEndTime">
                            </div>
                            <button type="button" class="toggle-time-btn" onclick="toggleEditTimeMode()">Use Preset Times</button>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Days of Week</label>
                    <div class="days-checkboxes">
                        <div class="day-checkbox-row">
                            <label><input type="checkbox" name="editDays" value="Monday"> Monday</label>
                            <label><input type="checkbox" name="editDays" value="Tuesday"> Tuesday</label>
                            <label><input type="checkbox" name="editDays" value="Wednesday"> Wednesday</label>
                            <label><input type="checkbox" name="editDays" value="Thursday"> Thursday</label>
                            <label><input type="checkbox" name="editDays" value="Friday"> Friday</label>
                        </div>
                    </div>
                </div>

                <div class="date-row">
                    <div class="form-group">
                        <label for="editStartDate">Start Date</label>
                        <input type="date" id="editStartDate" required>
                    </div>
                    <div class="form-group">
                        <label for="editEndDate">End Date</label>
                        <input type="date" id="editEndDate" required>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="submit" class="btn-save">Save Changes</button>
                    <button type="button" class="btn-cancel" onclick="closeEditModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Google Calendar Notification Modal -->
    <div id="googleCalendarNotification" class="modal" style="display: none;">
        <div class="modal-content modal-notification">
            <div class="modal-header">
                <h2>Google Calendar Sync Notice</h2>
                <span class="close" onclick="closeGoogleNotification()">&times;</span>
            </div>
            <div class="modal-body">
                <p id="googleNotificationMessage"></p>
                <div class="modal-actions">
                    <button type="button" class="btn-primary" onclick="redirectToGoogleLogin()">Re-login to Google</button>
                    <button type="button" class="btn-cancel" onclick="closeGoogleNotification()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sync Status Modal -->
    <div id="syncStatusModal" class="modal" style="display: none;">
        <div class="modal-content modal-notification">
            <div class="modal-header">
                <h2>Google Calendar Sync Status</h2>
                <span class="close" onclick="SyncStatusChecker.closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="syncStatusList"></div>
                <div class="modal-actions">
                    <button type="button" class="btn-primary" onclick="SyncStatusChecker.closeModal()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Color Picker Modal -->
    <div id="colorPickerModal" class="modal" style="display: none;">
        <div class="modal-content modal-color-picker">
            <div class="modal-header">
                <h2>Select Color</h2>
                <span class="close" onclick="ColorPicker.closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="colorPickerMessage" class="color-message" style="display: none;"></div>
                <div class="color-grid-container">
                    <div id="colorGrid" class="color-grid"></div>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-save-color" onclick="ColorPicker.closeModal()">Done</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Set API base URL for use in modules (must be before constants.js)
    window.API_BASE_URL = '<%= apiBaseUrl %>';
</script>

<!-- Dashboard Module Scripts -->
<script src="/js/dashboard/constants.js"></script>
<script src="/js/dashboard/form-data-persistence.js"></script>
<script src="/js/dashboard/time-slots.js"></script>
<script src="/js/dashboard/form-generation.js"></script>
<script src="/js/dashboard/validation.js"></script>
<script src="/js/dashboard/semester.js"></script>
<script src="/js/dashboard/calendar-selection.js"></script>
<script src="/js/dashboard/google-auth-status.js"></script>
<script src="/js/dashboard/sync-status.js"></script>
<script src="/js/dashboard/color-picker.js"></script>
<script src="/js/dashboard/api.js"></script>
<script src="/js/dashboard/ui-renderer.js"></script>
<script src="/js/dashboard/form-submission.js"></script>
<script src="/js/dashboard/app.js"></script>
